title: 机智云通用串口协议解析
---

# 1、前言

协议主要分三部分：基本通信协议、扩展通信协议和网关扩展协议。第一，基本通信协议上面的内容，所有的mcu端开发者都要完成上面的协议；第二，扩展通信协议，是可选择完成的协议，上面主要提供的功能是大数据传输，要做mcu ota 升级的功能，就要完成上面的协议。第三，网关扩展协议，主要是做轻网关方案项目的产品，如果产品是做网关方案的，如蓝牙Mesh，就需要完成上面的协议。

# 2、协议下载流程

### 2.1根据已经创建好的产品，并且定义好数据点，选中产品

![name](/assets/zh-cn/deviceDev/debug/NB_project/000000000000000000000.png)

### 2.2下载模组与mcu之间的串口通信协议

![name](/assets/zh-cn/deviceDev/debug/NB_project/000000000000000000000.png)

# 3、协议内容说明

### 3.1

mcu与WiFi模组通过串口交互，通用固件：波特率9600/数据位8位、无奇偶校验/停止位1位/无数据流控。数据帧格式如下：

| 字段  | 长度(byte) | 内容说明 |
| ------------- | ------------- | ------------- |
| 固定包头  | 2 | 固定0xFFFF |
| 包长度  | 2  | len(命令...校验和) |
| 命令  | 1  | 具体指令 |
| 包序号  | 1  | 对应发送包的包序号 |
| flags  | 2  | 固定0x0000 |
| 业务  | xxxx  | 根据具体指令查看 |
| 校验和  | 1  |  |

基本通信协议部分WiFi模组和mcu命令表如下：

| 发起端=>接收端  | WiFi模组命令 | mcu命令字 | 说明 |
| ------------- | ------------- | ------------- | ------------- |
| WiFi=>mcu  | 0x01  | 0x02 | 获取设备信息 |
| WiFi=>mcu  | 0x0d  | 0x0e | 推送WiFi模组工作状态 |
| WiFi=>mcu  | 0x07  | 0x08 | 心跳 |
| mcu=>WiFi  | 0x0a  | 0x09 | 通知WiFi模组进入配网模式 |
| WiFi=>mcu  | 0x03  | 0x04 | WiFi模组读取设备的当前状态（与WiFi模组控制设备的区别是通过action位字段来区别，WiFi模组读取设备的当前状态action位02，而WiFi模组控制设备action位为01） |
| WiFi=>mcu  | 0x03  | 0x04 | WiFi模组控制设备 |
| mcu=>WiFi  | 0x05  | 0x06 | 设备MCU向WiFi模组主动上报当前状态 |
| mcu=>WiFi  | 0x0b  | 0x0c | 重置WiFi模组，或者说给WiFi模组恢复出厂设置。 |

此外，机智云串口通信协议的数据传输方式有两种：定长和变长。

* 定长和变长功能上的区别：

（1）定长方式是“3.4 设备mcu向WiFi模组主动上报当前状态”上面的attr_flags和dev_status 序号的数据，全部都要上传。

（2）变长方式是“3.4 设备mcu向WiFi模组主动上报当前状态”上面的attr_flags和dev_status 序号的数据，只需要上报设备状态改变的。

* 定长和变长指令上的区别，主要是以下三个协议上面的action位不一样。

###### 3.2 WiFi模组控制设备
###### 3.3 WiFi模组读取设备的当前状态
###### 3.4 设备MCU向WiFi模组主动上报当前状态

| 协议  | 发起端=>接收端 | 定长的action位 | 变长的action位 |
| ------------- | ------------- | ------------- | ------------- |
| 3.2  | WiFi->mcu  | 0x01 | 0x11 |
| 3.3  | WiFi->mcu  | 0x02 | 0x12 |
| 3.3  | mcu->Wifi  | 0x03 | 0x13 |
| 3.4  | mcu->Wifi  | 0x04 | 0x14 |

### 3.2基本通信协议

根据串口协议《3.基本通讯协议(必须)》上面的指令，mcu嵌入式开发流程。


# 4、搭配gokit接入机智云（包含创建数据点，下载代码，demoAPP配网绑定及控制设备等等发）



# 5、FAQ


